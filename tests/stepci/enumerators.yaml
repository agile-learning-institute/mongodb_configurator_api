version: "1.1"
name: Test Enumerators Endpoints
env:
  host: localhost:8081

tests:
  enumerators:
    name: Test Enumerators Endpoints
    steps:
      # Get current enumerators state
      - name: Get Current Enumerators
        http:
          url: http://${{env.host}}/api/enumerators/
          method: GET
          check:
            status: /200/
          capture:
            original_state: $.enumerators

      # Test PUT with modified data
      - name: Put Enumerators
        http:
          url: http://${{env.host}}/api/enumerators/
          method: PUT
          headers:
            Content-Type: application/json
          body: |
            [
              {
                "version": 0,
                "enumerators": {}
              },
              {
                "version": 1,
                "enumerators": {
                  "test_enum": {
                    "foo": "bar"
                  }
                }
              }
            ]
          check:
            status: /200/
            jsonpath:
              enumerators[1].enumerators.test_enum.foo: "bar"
            schema:
              created_at:
                type: string
                format: date-time
              updated_at:
                type: string
                format: date-time
              size:
                type: number

      # Verify the PUT worked
      - name: Get Enumerators After Put
        http:
          url: http://${{env.host}}/api/enumerators/
          method: GET
          check:
            status: /200/
            jsonpath:
              $.enumerators[1].enumerators.test_enum.foo: "bar"

      # Restore original state
      - name: Restore Original Enumerators
        http:
          url: http://${{env.host}}/api/enumerators/
          method: PUT
          headers:
            Content-Type: application/json
          body: |
            ${{original_state}}
          check:
            status: /200/