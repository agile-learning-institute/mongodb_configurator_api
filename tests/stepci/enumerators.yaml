version: "1.1"
name: Test Enumerators Endpoints
env:
  host: localhost:8081

tests:
  enumerators:
    name: Test Enumerators Endpoints
    steps:
      # Test PUT with modified data
      - name: Put Enumerators
        http:
          url: http://${{env.host}}/api/enumerators/
          method: PUT
          headers:
            Content-Type: application/json
          body: |
            [
              {
                "version": 0,
                "enumerators": {}
              },
              {
                "version": 1,
                "enumerators": {
                  "test_enum": {
                    "foo": "bar"
                  }
                }
              }
            ]
          check:
            status: /200/
            jsonpath:
              $[1].enumerators.test_enum.foo: "bar"
            schema:
              created_at:
                type: string
                format: date-time
              updated_at:
                type: string
                format: date-time
              size:
                type: number

      # Verify the PUT worked
      - name: Get Enumerators After Put
        http:
          url: http://${{env.host}}/api/enumerators/
          method: GET
          check:
            status: /200/
            jsonpath:
              $[1].enumerators.test_enum.foo: "bar"

      # Restore to original state from enumerators.json
      - name: Restore Original Enumerators
        http:
          url: http://${{env.host}}/api/enumerators/
          method: PUT
          headers:
            Content-Type: application/json
          body: |
            [
              {
                "version": 0,
                "enumerators": {}
              },
              {
                "version": 1,
                "enumerators": {
                  "default_status": {
                    "active": "Not Deleted",
                    "archived": "Soft Delete Indicator"
                  }
                }
              },
              {
                "version": 2,
                "enumerators": {
                  "default_status": {
                    "draft": "Draft",
                    "active": "Not Deleted",
                    "archived": "Soft Delete Indicator"
                  }
                }
              }
            ]
          check:
            status: /200/