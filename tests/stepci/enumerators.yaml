version: "1.1"
name: Test Enumerators Endpoints
env:
  host: localhost:8081

tests:
  enumerators:
    name: Test Enumerators Endpoints
    steps:
      # Test PUT with modified data for individual enumeration files
      - name: Put Enumerations 0
        http:
          url: http://${{env.host}}/api/enumerators/enumerations.0.yaml/
          method: PUT
          headers:
            Content-Type: application/json
          body: |
            {
              "name": "Enumerations",
              "status": "Active",
              "version": 0,
              "enumerators": {}
            }
          check:
            status: /200/
            jsonpath:
              file_name: enumerations.0.yaml
              created_at: /.+/
              updated_at: /.+/
              size: /\d+/

      - name: Put Enumerations 1
        http:
          url: http://${{env.host}}/api/enumerators/enumerations.1.yaml/
          method: PUT
          headers:
            Content-Type: application/json
          body: |
            {
              "name": "Enumerations",
              "status": "Active",
              "version": 1,
              "enumerators": {
                "default_status": {
                  "active": "Not Deleted",
                  "archived": "Soft Delete Indicator"
                },
                "test_enum": {
                  "foo": "bar"
                }
              }
            }
          check:
            status: /200/
            jsonpath:
              file_name: enumerations.1.yaml
              created_at: /.+/
              updated_at: /.+/
              size: /\d+/

      - name: Put Enumerations 2
        http:
          url: http://${{env.host}}/api/enumerators/enumerations.2.yaml/
          method: PUT
          headers:
            Content-Type: application/json
          body: |
            {
              "name": "Enumerations",
              "status": "Active",
              "version": 2,
              "enumerators": {}
            }
          check:
            status: /200/
            jsonpath:
              file_name: enumerations.2.yaml
              created_at: /.+/
              updated_at: /.+/
              size: /\d+/

      # Verify the PUT worked by getting individual files
      - name: Get Enumerations 1 After Put
        http:
          url: http://${{env.host}}/api/enumerators/enumerations.1.yaml/
          method: GET
          check:
            status: /200/
            jsonpath:
              enumerators.test_enum.foo: "bar"
              enumerators.default_status.active: "Not Deleted"

      # Restore to original state
      - name: Restore Original Enumerations 1
        http:
          url: http://${{env.host}}/api/enumerators/enumerations.1.yaml/
          method: PUT
          headers:
            Content-Type: application/json
          body: |
            {
              "name": "Enumerations",
              "status": "Active",
              "version": 1,
              "enumerators": {
                "default_status": {
                  "active": "Not Deleted",
                  "archived": "Soft Delete Indicator"
                },
                "test_enum": {
                  "foo": "bar"
                }
              }
            }
          check:
            status: /200/
            jsonpath:
              file_name: enumerations.1.yaml
              created_at: /.+/
              updated_at: /.+/
              size: /\d+/